# Copyright (c) 2024 ROS2 OpenHarmony Port Project
# type_description_interfaces - ROS2 type description interface types

import("//build/ohos.gni")
import("//gn_templates/ros2_library.gni")

_package_name = "type_description_interfaces"

# ============================================================================
# type_description_interfaces types:
#
# Messages:
#   FieldType              - Type info for a field (nested/array/capacity)
#   Field                  - A field in a type (name + type)
#   IndividualTypeDescription - Single type description
#   TypeDescription        - Full type description with dependencies
#   TypeSource             - Source/definition of a type
#   KeyValue               - Key-value metadata pair
# ============================================================================

# ============================================================================
# type_description_interfaces C generator library
# ============================================================================
ros2_shared_library("type_description_interfaces__rosidl_generator_c") {
  sources = [
    "src/msg/field_type__functions.c",
    "src/msg/field__functions.c",
    "src/msg/individual_type_description__functions.c",
    "src/msg/type_description__functions.c",
    "src/msg/type_source__functions.c",
    "src/msg/key_value__functions.c",
  ]

  include_dirs = [ "include" ]

  deps = [
    "//foundation/rcutils:rcutils",
    "//foundation/rosidl/rosidl_runtime_c:rosidl_runtime_c",
  ]

  defines = [ "ROSIDL_GENERATOR_C_BUILDING_DLL_${_package_name}" ]

  part_name = "ros2_foundation"
  subsystem_name = "ros2"
}

# ============================================================================
# type_description_interfaces type support C library
# ============================================================================
ros2_shared_library("type_description_interfaces__rosidl_typesupport_c") {
  sources = [
    "src/msg/field_type__type_support.c",
    "src/msg/field__type_support.c",
    "src/msg/individual_type_description__type_support.c",
    "src/msg/type_description__type_support.c",
    "src/msg/type_source__type_support.c",
    "src/msg/key_value__type_support.c",
  ]

  include_dirs = [ "include" ]

  deps = [
    ":type_description_interfaces__rosidl_generator_c",
    "//foundation/rcutils:rcutils",
    "//foundation/rosidl/rosidl_runtime_c:rosidl_runtime_c",
    "//foundation/rosidl/rosidl_typesupport_c:rosidl_typesupport_c",
    "//foundation/rosidl/rosidl_typesupport_introspection_c:rosidl_typesupport_introspection_c",
  ]

  defines = [ "ROSIDL_TYPESUPPORT_C_BUILDING_DLL" ]

  part_name = "ros2_foundation"
  subsystem_name = "ros2"
}

# ============================================================================
# type_description_interfaces FastRTPS type support
# ============================================================================
ros2_shared_library("type_description_interfaces__rosidl_typesupport_fastrtps_c") {
  sources = [
    "src/msg/field_type__rosidl_typesupport_fastrtps_c.cpp",
    "src/msg/field__rosidl_typesupport_fastrtps_c.cpp",
    "src/msg/individual_type_description__rosidl_typesupport_fastrtps_c.cpp",
    "src/msg/type_description__rosidl_typesupport_fastrtps_c.cpp",
    "src/msg/type_source__rosidl_typesupport_fastrtps_c.cpp",
    "src/msg/key_value__rosidl_typesupport_fastrtps_c.cpp",
  ]

  include_dirs = [ "include" ]

  deps = [
    ":type_description_interfaces__rosidl_generator_c",
    "//foundation/rcutils:rcutils",
    "//foundation/rosidl/rosidl_runtime_c:rosidl_runtime_c",
    "//foundation/rosidl/rosidl_typesupport_fastrtps_c:rosidl_typesupport_fastrtps_c",
    "//vendor/fastdds/fastcdr:fastcdr",
  ]

  defines = [ "ROSIDL_TYPESUPPORT_FASTRTPS_C_BUILDING_DLL_${_package_name}" ]

  cflags_cc = [ "-Wno-unused-parameter" ]

  part_name = "ros2_foundation"
  subsystem_name = "ros2"
}

# ============================================================================
# type_description_interfaces C++ type support
# ============================================================================
config("type_description_interfaces_cpp_config") {
  include_dirs = [ "include" ]
}

ros2_shared_library("type_description_interfaces__rosidl_typesupport_cpp") {
  sources = [
    "src/msg/field_type__type_support.cpp",
    "src/msg/field__type_support.cpp",
    "src/msg/individual_type_description__type_support.cpp",
    "src/msg/type_description__type_support.cpp",
    "src/msg/type_source__type_support.cpp",
    "src/msg/key_value__type_support.cpp",
  ]

  include_dirs = [ "include" ]

  deps = [
    ":type_description_interfaces__rosidl_generator_c",
    "//foundation/rosidl/rosidl_runtime_cpp:rosidl_runtime_cpp",
    "//foundation/rosidl/rosidl_typesupport_cpp:rosidl_typesupport_cpp",
    "//foundation/rosidl/rosidl_typesupport_introspection_cpp:rosidl_typesupport_introspection_cpp",
  ]

  defines = [ "ROSIDL_TYPESUPPORT_CPP_BUILDING_DLL" ]

  part_name = "ros2_foundation"
  subsystem_name = "ros2"
}

# ============================================================================
# Package group target
# ============================================================================
group("type_description_interfaces") {
  public_deps = [
    ":type_description_interfaces__rosidl_generator_c",
    ":type_description_interfaces__rosidl_typesupport_c",
    ":type_description_interfaces__rosidl_typesupport_cpp",
    ":type_description_interfaces__rosidl_typesupport_fastrtps_c",
  ]

  public_configs = [ ":type_description_interfaces_cpp_config" ]
}
